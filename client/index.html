<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <script src="/env-config.js"></script>
  <title>Datasetto</title>
</head>

<body>
  <div id="app" class="app-shell flex h-screen w-screen overflow-hidden">
    <!-- Left Sidebar: Channels + User Area -->
    <aside class="sidebar flex flex-col w-[260px] bg-bg-sidebar flex-shrink-0 overflow-hidden border-r border-white/5"
      role="navigation" aria-label="Server navigation">
      <!-- Sidebar Header -->
      <div
        class="sidebar-header px-4 py-3 flex items-center justify-between min-h-[52px] shadow-sm sticky top-0 z-sticky bg-bg-sidebar/95 backdrop-blur-sm">
        <strong class="text-base font-bold text-white tracking-tight flex items-center gap-2.5">
          <div
            class="w-6 h-6 rounded bg-brand-primary flex items-center justify-center text-white shadow-lg shadow-brand-primary/20">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
          </div>
          Datasetto
        </strong>
        <button id="mobile-sidebar-close" class="mobile-sidebar-close-btn" type="button"
          aria-label="Close navigation">‚úï</button>
      </div>

      <!-- Channels Section -->
      <div class="sidebar-scroller flex-1 overflow-y-auto overflow-x-hidden py-3 pl-2 pr-1 custom-scrollbar">
        <!-- Text Channels -->
        <div class="mb-5">
          <div
            class="group flex items-center justify-between px-2 py-1 mb-1 cursor-pointer select-none rounded transition-fast hover:text-text-normal">
            <span
              class="text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2 transition-colors group-hover:text-text-normal">Text
              Channels</span>
            <button id="create-text-channel" class="create-channel-btn" title="Create Text Channel">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
          <div class="channel-list space-y-[2px]" id="text-channels">
            <!-- Dynamic text channels will be inserted here -->
          </div>
        </div>

        <!-- Voice Channels -->
        <div class="mb-5">
          <div
            class="group flex items-center justify-between px-2 py-1 mb-1 cursor-pointer select-none rounded transition-fast hover:text-text-normal">
            <span
              class="text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2 transition-colors group-hover:text-text-normal">Voice
              Channels</span>
            <button id="create-voice-channel" class="create-channel-btn" title="Create Voice Channel">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
          <div class="channel-list space-y-[2px]" id="channelsList">
            <!-- Dynamic voice channels will be inserted here -->
          </div>
        </div>

        <!-- Minigames -->
        <div class="mb-5">
          <div
            class="group flex items-center justify-between px-2 py-1 mb-1 cursor-pointer select-none rounded transition-fast hover:text-text-normal">
            <span
              class="text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2 transition-colors group-hover:text-text-normal">Minigames</span>
            <span class="text-[10px] font-semibold uppercase tracking-wider text-brand-primary">Beta</span>
          </div>
          <div class="channel-list space-y-[2px]" id="minigame-launchers">
            <button id="minigame-open" type="button"
              class="channel-item flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-sm font-medium text-text-muted transition-fast hover:bg-white/5 hover:text-white">
              <span class="channel-icon text-lg" aria-hidden="true">üéÆ</span>
              <span class="channel-name truncate flex-1">Slither Arena</span>
              <span id="minigame-launcher-status"
                class="rounded-full border border-white/10 px-2 py-1 text-[10px] font-semibold uppercase tracking-wider text-text-muted">Available</span>
            </button>
          </div>
        </div>

        <!-- Streams -->
        <div class="mb-5">
          <div
            class="group flex items-center justify-between px-2 py-1 mb-1 cursor-pointer select-none rounded transition-fast hover:text-text-normal">
            <span
              class="text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2 transition-colors group-hover:text-text-normal">Live
              Streams</span>
            <button id="create-stream-channel" class="create-channel-btn" title="Create Stream Channel">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
          <div class="channel-list space-y-[2px]" id="stream-channels">
            <!-- Dynamic stream channels will be inserted here -->
          </div>
        </div>

        <!-- Screenshare Rooms -->
        <div class="mb-5">
          <div
            class="group flex items-center justify-between px-2 py-1 mb-1 cursor-pointer select-none rounded transition-fast hover:text-text-normal">
            <span
              class="text-xs font-bold text-text-muted uppercase tracking-wider flex items-center gap-2 transition-colors group-hover:text-text-normal">Screenshare</span>
            <button id="create-screenshare-channel" class="create-channel-btn" title="Create Screenshare Room">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
          <div class="channel-list space-y-[2px]" id="screenshare-channels">
            <!-- Dynamic screenshare channels will be inserted here -->
          </div>
        </div>
      </div>

      <!-- User Area (Bottom) -->
      <div class="mt-auto flex-shrink-0">
        <!-- Voice Status (when connected) -->
        <div id="voice-status-panel" class="p-3 border-t border-black/30 bg-black/20 hidden">
          <div class="flex items-center gap-2 text-xs font-bold text-success mb-2 uppercase tracking-wide">
            <span class="text-lg voice-pulse flex-shrink-0">üîä</span>
            <div class="flex flex-col gap-0.5 overflow-hidden">
              <span id="connected-voice-channel">Voice Channel</span>
              <span id="watching-stream-indicator"
                class="text-[10px] font-medium text-brand normal-case tracking-normal opacity-90 whitespace-nowrap overflow-hidden text-ellipsis hidden">üì∫
                Watching stream</span>
            </div>
          </div>
          <div class="voice-toggle-group flex gap-2 flex-wrap">
            <button id="mute" class="voice-toggle-btn" aria-label="Toggle microphone" title="Toggle mic">
              <span class="voice-toggle-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 16a4 4 0 0 0 4-4V7a4 4 0 0 0-8 0v5a4 4 0 0 0 4 4z" />
                  <path d="M19 11a7 7 0 0 1-14 0" />
                  <line x1="12" y1="19" x2="12" y2="22" />
                  <line x1="9" y1="22" x2="15" y2="22" />
                </svg>
              </span>
              <span class="voice-toggle-label">Mute Mic</span>
            </button>
            <button id="deafen" class="voice-toggle-btn" aria-label="Toggle output mute" title="Toggle output">
              <span class="voice-toggle-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 18v-6a7 7 0 0 1 14 0v6" />
                  <path d="M5 18a2 2 0 0 0 2 2h1" />
                  <path d="M19 18a2 2 0 0 1-2 2h-1" />
                  <line x1="8" y1="14" x2="8" y2="18" />
                  <line x1="16" y1="14" x2="16" y2="18" />
                </svg>
              </span>
              <span class="voice-toggle-label">Mute Out</span>
            </button>
            <button id="mute-output-combo" class="voice-toggle-btn" aria-label="Toggle mic and output"
              title="Mute mic and output" aria-pressed="false">
              <span class="voice-toggle-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 11V6a4 4 0 0 1 8 0v5" />
                  <path d="M5 11a7 7 0 0 0 14 0" />
                  <path d="M4 15v3a2 2 0 0 0 2 2h1" />
                  <path d="M20 15v3a2 2 0 0 1-2 2h-1" />
                  <path d="M3 3l18 18" />
                </svg>
              </span>
              <span class="voice-toggle-label">Mute All</span>
            </button>
          </div>
        </div>

        <!-- Voice Users Panel (Discord-like) -->
        <div id="voice-users-panel"
          class="voice-users-panel bg-black/20 border-t border-black/30 max-h-[280px] overflow-y-auto flex-shrink-0 custom-scrollbar hidden">
          <div
            class="px-4 py-3 text-2xs font-bold uppercase text-text-muted tracking-wider bg-black/30 sticky top-0 z-sticky flex items-center justify-between gap-3">
            <span class="text-text-normal"><span id="voice-user-count">0</span> members</span>
            <div class="flex items-center gap-2">
              <span class="text-2xs font-semibold tracking-wide text-text-muted inline-flex hidden"
                id="voice-session-timer" aria-live="polite">--:--</span>
              <button id="mobile-voice-close" class="mobile-voice-close-btn" type="button"
                aria-label="Close voice panel">‚úï</button>
            </div>
          </div>
          <div class="py-2" id="voice-users-list">
            <!-- Dynamic voice users will be inserted here -->
          </div>
        </div>

        <!-- User Profile Bar -->
        <div class="p-3 bg-black/20 border-t border-white/5 flex items-center gap-3 backdrop-blur-md">
          <div
            class="w-10 h-10 rounded-full bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center text-white font-bold text-base flex-shrink-0 shadow-lg ring-1 ring-white/10"
            id="user-avatar" aria-label="User avatar" role="img"></div>
          <div class="flex-1 min-w-0">
            <div class="text-sm font-semibold text-text-normal truncate" id="accName">User</div>
            <div class="text-xs text-text-muted truncate" id="user-status-text">Online</div>
          </div>
          <div class="flex items-center gap-1 relative">
            <button id="superuser-menu-btn"
              class="hidden w-8 h-8 rounded-md flex items-center justify-center text-lg transition-all hover:bg-white/10 hover:text-brand-primary hover:scale-105 active:scale-95"
              aria-label="Superuser actions" title="Superuser Actions" aria-haspopup="true" aria-expanded="false"
              type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
            </button>
            <div id="superuser-menu"
              class="absolute bottom-full right-0 mb-2 bg-bg-tertiary border border-white/10 rounded-xl p-2 min-w-[180px] shadow-2xl z-dropdown hidden backdrop-blur-xl"
              role="menu" aria-hidden="true">
              <button id="superuser-manage-users"
                class="w-full px-3 py-2 rounded-lg cursor-pointer text-text-normal flex items-center gap-3 transition-fast hover:bg-white/5 text-left text-sm font-medium"
                role="menuitem" type="button">Manage Users</button>
              <button id="superuser-manage-channels"
                class="w-full px-3 py-2 rounded-lg cursor-pointer text-text-normal flex items-center gap-3 transition-fast hover:bg-white/5 text-left text-sm font-medium"
                role="menuitem" type="button">Manage Channels</button>
            </div>
            <button id="user-settings-btn"
              class="w-8 h-8 rounded-md flex items-center justify-center text-lg transition-all hover:bg-white/10 hover:text-brand-primary hover:scale-105 active:scale-95"
              aria-label="User settings" title="User Settings">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content: Chat -->
    <main class="main-content chat-content flex-1 flex flex-col bg-bg-chat overflow-hidden" role="main">
      <h1 id="current-channel-name" class="hidden">general</h1>

      <section id="voice-call-stage"
        class="voice-call-stage hidden w-full max-w-6xl self-center flex flex-col gap-6 px-6 py-8 lg:px-10">
        <div id="voiceGallery" class="voice-gallery hidden" role="list" aria-live="polite"
          aria-label="Voice channel participants"></div>
      </section>

      <section id="minigame-stage"
        class="minigame-stage hidden w-full max-w-6xl self-center flex flex-col gap-6 px-6 py-8 lg:px-10"
        aria-label="Game Arena">
        <div class="minigame-stage-toolbar flex w-full flex-col gap-3 rounded-2xl border border-white/5 bg-gradient-to-br from-bg-secondary/40 via-bg-tertiary/60 to-black/60 px-6 py-5 shadow-2xl shadow-black/40 lg:flex-row lg:items-center lg:justify-between lg:gap-6">
          <div class="flex flex-1 flex-col gap-2">
            <div class="flex items-center gap-2 text-[11px] font-semibold uppercase tracking-[0.35em] text-brand-primary">
              <span class="inline-flex h-1.5 w-1.5 animate-pulse rounded-full bg-brand-primary"></span>
              Game Arena
            </div>
            <div class="flex flex-col gap-1">
              <h2 class="text-2xl font-black text-white tracking-tight">Slither Arena</h2>
              <p class="text-sm text-text-muted">Squad up, claim pellets, and dominate the nebula grid. Keep the arena open to stay synced with your
                voice squad.</p>
            </div>
          </div>
          <button id="minigame-close"
            class="self-start rounded-full border border-white/20 bg-transparent px-5 py-2 text-2xs font-semibold uppercase tracking-[0.35em] text-text-muted transition-fast hover:border-white/40 hover:text-white lg:self-auto"
            type="button">Back</button>
        </div>

        <div id="minigame-container"
          class="minigame-screen hidden rounded-2xl border border-white/10 bg-black/30 p-6 lg:p-10">
          <div class="flex flex-col gap-8">
            <header class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
              <div class="flex flex-col gap-1">
                <p class="text-[11px] font-semibold uppercase tracking-[0.35em] text-brand-primary">Game Intel</p>
                <h3 class="text-lg font-semibold text-white">Arena Status</h3>
                <p id="minigame-status" class="text-sm leading-relaxed text-text-muted">Loading...</p>
              </div>
              <div class="flex flex-wrap items-center gap-2 text-2xs font-semibold uppercase">
                <button id="minigame-start"
                  class="rounded-md bg-brand-primary px-4 py-2 text-white transition-fast hover:bg-brand-hover"
                  type="button">Start Slither Arena</button>
                <button id="minigame-end"
                  class="hidden rounded-md bg-danger/10 px-4 py-2 text-danger transition-fast hover:bg-danger hover:text-white"
                  type="button">End</button>
              </div>
            </header>

            <div class="flex flex-col gap-8 lg:flex-row lg:items-start">
              <aside class="flex w-full max-w-sm flex-col gap-4 rounded-xl border border-white/10 bg-black/25 p-5">
                <div class="text-xs font-semibold uppercase tracking-widest text-text-muted">Squad Board</div>
                <ul id="minigame-scores" class="space-y-2 text-xs text-text-muted"></ul>
                <div class="flex items-center gap-2 text-xs font-semibold">
                  <button id="minigame-join"
                    class="rounded-md bg-brand-primary px-4 py-2 text-white transition-fast hover:bg-brand-hover"
                    type="button">Join</button>
                  <button id="minigame-leave"
                    class="hidden rounded-md bg-bg-floating px-4 py-2 transition-fast hover:bg-brand-primary hover:text-white"
                    type="button">Leave</button>
                </div>
              </aside>

              <div class="flex flex-1 items-center justify-center">
                <div class="w-full max-w-2xl">
                  <canvas id="minigame-canvas"
                    class="w-full aspect-square rounded-xl border border-white/10 bg-black/60" width="512"
                    height="512"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="streamLayout" class="stream-layout" data-mode="text">
        <!-- Stream Player Column -->
        <section id="streamPlayerColumn" class="stream-player-column hidden">
          <!-- Inline Video Container (for stream channels - Theater Mode) -->
          <div id="inlineVideoContainer" class="inline-video-container flex-shrink-0 bg-black relative hidden">
            <div class="inline-video-header absolute top-0 left-0 right-0 p-4 flex items-center gap-4 bg-gradient-to-b from-black/70 to-transparent z-10">
              <button id="theaterModeToggle"
                class="px-4 py-2 bg-bg-tertiary/90 backdrop-blur-sm rounded-md flex items-center gap-2 font-semibold transition-fast hover:bg-bg-floating hover:shadow-md"
                aria-label="Back to channels" title="Back to Channels">
                <span>‚¨ÖÔ∏è</span>
                <span>Back</span>
              </button>
              <div class="text-lg font-bold text-white" id="mobileStreamTitle" aria-live="polite">Live Stream</div>
              <button id="popoutVideo"
                class="ml-auto w-9 h-9 rounded-full bg-bg-tertiary/85 backdrop-blur-sm flex items-center justify-center text-white text-lg shadow-md transition-fast hover:bg-bg-floating"
                aria-label="Pop out video" title="Pop out video">‚á±</button>
            </div>

            <div class="inline-video-stage relative w-full aspect-video bg-black">
              <video id="inlineVideo" class="w-full h-full" aria-label="Video player" autoplay muted playsinline webkit-playsinline></video>
              <div id="inlinePlayerOverlay" class="video-player-overlay" aria-live="polite">
                <div class="overlay-content">
                  <div class="overlay-spinner w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin" aria-hidden="true"></div>
                  <p class="message">No stream</p>
                </div>
              </div>
            </div>

            <div class="video-controls-bar" id="videoControlsBar">
              <div class="video-controls-left">
                <button id="playPauseBtn" class="control-btn" aria-label="Play/Pause" title="Play/Pause">
                  <span class="icon">‚ñ∂Ô∏è</span>
                </button>
                <div class="volume-control">
                  <button id="volumeBtn" class="control-btn" aria-label="Mute/Unmute" title="Mute/Unmute">
                    <span class="icon" id="volumeIcon">üîä</span>
                  </button>
                  <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="0" aria-label="Volume" />
                </div>
                <span class="live-indicator-badge hidden inline-flex items-center" aria-live="polite" aria-hidden="true">
                  <span class="status-dot" aria-hidden="true"></span>
                  <span class="status-text">OFFLINE</span>
                </span>
              </div>
              <div class="video-controls-right">
                <button id="fullscreenBtn" class="control-btn" aria-label="Fullscreen" title="Fullscreen">
                  <span class="icon">üóñ</span>
                </button>
              </div>
            </div>
          </div>

          <div id="screenshareControls" class="screenshare-controls hidden" aria-live="polite">
            <div class="screenshare-status" id="screenshareStatusLabel">Select a screenshare channel to get started.</div>
            <div class="screenshare-actions">
              <button id="screenshareStartBtn" type="button" class="screenshare-btn primary">Start Screenshare</button>
              <button id="screenshareStopBtn" type="button" class="screenshare-btn danger hidden">Stop Sharing</button>
            </div>
          </div>
        </section>

        <!-- Stream Chat Column -->
        <aside id="streamChatDock" class="stream-chat-dock hidden" aria-hidden="true" role="complementary" aria-label="Channel chat">
          <header class="stream-chat-header">
            <div class="stream-chat-title text-channel-title" id="streamChatTitle">#general</div>
            <div class="stream-chat-status" id="streamChatStatus" aria-live="polite">Chat docked</div>
          </header>

          <!-- Chat Messages -->
          <div id="msgs" class="chat-log flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar" role="log" aria-live="polite" aria-label="Chat messages">
            <!-- Messages will be dynamically inserted here -->
          </div>

          <!-- Chat Input -->
          <div id="chat-input-container" class="chat-input-container flex-shrink-0 relative">
            <form id="chatForm" class="flex items-center gap-3" aria-label="Send message">
              <button type="button" id="emojiPickerBtn" class="text-2xl flex-shrink-0 hover:scale-110 transition-fast text-text-muted hover:text-text-normal"
                aria-label="Add emoji" aria-haspopup="dialog" aria-controls="emojiPicker" aria-expanded="false" title="Add Emoji">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
              </button>
              <input type="text" id="chatInput" class="flex-1 bg-transparent border-none text-text-normal text-base outline-none"
                placeholder="Message #general" aria-label="Message input" autocomplete="off" />
              <button type="submit" class="text-2xl flex-shrink-0 hover:scale-110 transition-fast text-brand-primary hover:text-brand-hover"
                aria-label="Send message" title="Send">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
              </button>
            </form>
            <!-- Emoji Picker Popup -->
            <div id="emojiPicker" class="emoji-picker hidden" role="dialog" aria-hidden="true">
              <div class="px-4 py-3 font-bold text-text-normal border-b border-white/10">Emojis</div>
              <div id="emojiGrid" class="emoji-grid grid grid-cols-8 gap-2 p-3 custom-scrollbar">
                <!-- Emojis will be populated here -->
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Right Sidebar: Members List -->
    <aside class="members-panel w-60 bg-bg-secondary flex-shrink-0 overflow-hidden border-l border-black/30 hidden"
      role="complementary" aria-label="Members list">
      <div class="px-4 py-3 text-2xs font-bold uppercase text-text-muted tracking-wider border-b border-black/30">
        Members ‚Äî <span id="member-count">0</span>
      </div>
      <div class="members-list p-2 overflow-y-auto custom-scrollbar" id="presenceList">
        <!-- Dynamic members will be inserted here -->
      </div>
    </aside>

    <!-- Video Popout -->
    <div id="video-popout"
      class="video-popout fixed bottom-4 right-4 w-96 bg-bg-tertiary rounded-lg shadow-lg overflow-hidden z-modal hidden"
      role="region" aria-label="Video player">
      <div class="px-4 py-3 bg-bg-secondary flex items-center justify-between cursor-move" id="video-popout-header">
        <span class="font-bold text-text-normal">Stream</span>
        <div class="flex gap-2">
          <button id="popinVideo"
            class="w-8 h-8 rounded flex items-center justify-center transition-fast hover:bg-bg-floating text-text-muted hover:text-text-normal"
            aria-label="Theater mode" title="Theater Mode">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg>
          </button>
          <button id="minimize-video"
            class="w-8 h-8 rounded flex items-center justify-center transition-fast hover:bg-bg-floating text-text-muted hover:text-text-normal"
            aria-label="Minimize video" title="Minimize">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
          </button>
          <button id="close-video"
            class="w-8 h-8 rounded flex items-center justify-center transition-fast hover:bg-danger hover:text-white text-text-muted"
            aria-label="Close video" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
      </div>
      <div class="relative aspect-video bg-black">
        <video id="video" class="w-full h-full" aria-label="Video player" autoplay muted playsinline
          webkit-playsinline></video>
        <div id="playerOverlay" class="video-player-overlay" aria-live="polite">
          <div class="overlay-content">
            <div
              class="overlay-spinner w-12 h-12 border-4 border-brand-primary border-t-transparent rounded-full animate-spin"
              aria-hidden="true"></div>
            <p class="message">No stream</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Stream Guide Modal -->
    <div id="streamInfoModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="stream-info-title">
      <div class="modal-card stream-guide-card">
        <div class="modal-header stream-guide-header">
          <div>
            <p class="stream-guide-eyebrow">Creator tools</p>
            <h3 id="stream-info-title">üì∫ How to Stream</h3>
            <p class="stream-guide-subtitle">Connect OBS (or any RTMP encoder) to Datasetto and go live in seconds. Scroll for the full checklist.</p>
          </div>
          <button id="streamInfoCancel" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body stream-guide-body modal-body-scrollable custom-scrollbar">
          <section class="stream-guide-panel stream-guide-values">
            <div class="stream-guide-value-card">
              <p class="stream-guide-label">Server URL</p>
              <div class="stream-guide-value">
                <code id="streamServerUrl">rtmp://datasetto.com/live</code>
                <button class="copy-btn"
                  onclick="navigator.clipboard.writeText(document.getElementById('streamServerUrl').textContent)">Copy</button>
              </div>
            </div>
            <div class="stream-guide-value-card">
              <p class="stream-guide-label">Stream Key</p>
              <div class="stream-guide-value">
                <code id="streamKeyDisplay">Tap üîë to fetch key</code>
                <button class="copy-btn"
                  onclick="navigator.clipboard.writeText(document.getElementById('streamKeyDisplay').textContent)">Copy</button>
              </div>
            </div>
          </section>

          <section class="stream-guide-panel">
            <h4>üìù Fast setup steps</h4>
            <ol class="stream-guide-steps">
              <li>Open OBS Studio (or your preferred RTMP encoder).</li>
              <li>Go to <strong>Settings ‚Üí Stream</strong> and choose <strong>Custom</strong> service.</li>
              <li>Paste the <strong>Server URL</strong> above.</li>
              <li>Copy the <strong>FULL Stream Key</strong> (everything after the <code>+</code> is required) and paste it.</li>
              <li>Click <strong>OK</strong> to save, then hit <strong>Start Streaming</strong>.</li>
              <li>Your stream appears in the selected channel within 3‚Äì10 seconds.</li>
            </ol>
          </section>

          <section class="stream-guide-panel">
            <h4>‚öôÔ∏è Recommended OBS settings</h4>
            <ul class="stream-guide-tips">
              <li><strong>Encoder:</strong> x264 or NVENC/AMF if available.</li>
              <li><strong>Bitrate:</strong> 2500‚Äì4000 Kbps for 1080p60.</li>
              <li><strong>Keyframe interval:</strong> 2 seconds.</li>
              <li><strong>Preset:</strong> Veryfast (x264) or Quality (NVENC).</li>
              <li><strong>Profile:</strong> High, CBR rate control.</li>
            </ul>
          </section>

          <section class="stream-guide-panel stream-guide-alert">
            <div class="stream-guide-alert-icon" aria-hidden="true">‚ö†Ô∏è</div>
            <div>
              <h4>Security check</h4>
              <p>Use the entire key shown above (e.g. <code>main-stream+ABC123XYZ</code>). Using only <span id="streamChannelName">Select a stream channel</span> will fail‚Äîthe token after the <code>+</code> keeps your stream private.</p>
            </div>
          </section>
        </div>
        <div class="modal-footer stream-guide-footer">
          <p class="stream-guide-footer-note">Need a key? Click the üîë icon next to a stream channel.</p>
          <button id="streamInfoClose" class="button-primary">Start streaming</button>
        </div>
      </div>
    </div>

    <!-- Create Channel Modal -->
    <div id="createChannelModal"
      class="fixed inset-0 bg-black/70 flex items-center justify-center z-modal backdrop-blur-sm hidden" role="dialog"
      aria-modal="true" aria-labelledby="create-channel-title">
      <div class="bg-bg-tertiary rounded-xl shadow-lg w-full max-w-md mx-4 overflow-hidden">
        <div class="px-6 py-4 border-b border-white/10 flex items-center justify-between">
          <h3 id="create-channel-title" class="text-xl font-bold text-text-normal">Create Channel</h3>
          <button id="createChannelCancel"
            class="w-8 h-8 rounded flex items-center justify-center transition-fast hover:bg-bg-floating hover:text-danger"
            aria-label="Close">‚úï</button>
        </div>
        <div class="px-6 py-4">
          <div class="mb-4">
            <label for="newChannelName" class="block text-sm font-semibold text-text-normal mb-2">Channel Name</label>
            <input type="text" id="newChannelName"
              class="w-full px-4 py-3 bg-bg-elevated border border-transparent text-text-normal rounded-md transition-fast focus:outline-none focus:border-brand-primary focus:ring-2 focus:ring-brand-primary/20"
              placeholder="e.g., general, lobby, main-stream" aria-label="Channel name" maxlength="32" />
            <span class="block mt-2 text-xs text-text-muted">Letters, numbers, hyphens only</span>
          </div>

          <input type="hidden" id="newChannelType" value="text" />

          <div id="createChannelError" class="text-danger text-sm mt-2"></div>
        </div>
        <div class="px-6 py-4 border-t border-white/10 flex justify-end">
          <button id="createChannelBtn"
            class="px-6 py-3 bg-brand-primary text-white rounded-md font-semibold transition-fast hover:bg-brand-hover active:bg-brand-active">Create
            Channel</button>
        </div>
      </div>
    </div>

    <!-- User Settings Modal (Profile) -->
    <div id="regModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title">
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="settings-modal-title">User Settings</h3>
          <button id="regCancel" aria-label="Close settings">‚úï</button>
        </div>
        <p id="settings-modal-subtitle" class="modal-subtitle hidden px-6 -mt-2 mb-4 text-text-muted text-sm"></p>
        <div class="modal-body modal-body-scrollable">
          <div class="modal-tabs auth-mode-tabs" role="tablist" aria-label="Authentication modes">
            <button id="authTabLogin" class="modal-tab" type="button" role="tab" aria-selected="false">
              <span class="modal-tab-icon" aria-hidden="true">üîê</span>
              <span class="modal-tab-text">
                <span class="modal-tab-title">Log In</span>
                <span class="modal-tab-subtitle">Use an existing account</span>
              </span>
            </button>
            <button id="authTabRegister" class="modal-tab" type="button" role="tab" aria-selected="false">
              <span class="modal-tab-icon" aria-hidden="true">‚ú®</span>
              <span class="modal-tab-text">
                <span class="modal-tab-title">Create Account</span>
                <span class="modal-tab-subtitle">Start fresh with a new profile</span>
              </span>
            </button>
            <button id="authTabProfile" class="modal-tab" type="button" role="tab" aria-selected="false">
              <span class="modal-tab-icon" aria-hidden="true">üë§</span>
              <span class="modal-tab-text">
                <span class="modal-tab-title">Profile</span>
                <span class="modal-tab-subtitle">Manage your details</span>
              </span>
            </button>
          </div>
          <p class="auth-mode-hint" id="auth-mode-hint">Choose how you‚Äôd like to continue.</p>

          <section id="authLoginSection" class="auth-section hidden flex flex-col gap-5 mb-6">
            <div class="form-group">
              <label for="authLoginEmail">Email</label>
              <input type="email" id="authLoginEmail" placeholder="name@example.com" aria-label="Email address"
                maxlength="254" autocomplete="email" />
            </div>

            <div class="form-group">
              <label for="authLoginPassword">Password</label>
              <input type="password" id="authLoginPassword" placeholder="Enter your password" aria-label="Password"
                autocomplete="current-password" />
            </div>
          </section>

          <section id="authRegisterSection" class="auth-section flex flex-col gap-5 mb-6">
            <div class="form-group">
              <label for="authRegisterEmail">Email</label>
              <input type="email" id="authRegisterEmail" placeholder="name@example.com" aria-label="Email address"
                maxlength="254" autocomplete="email" />
              <span class="form-hint">We‚Äôll use this for login. No marketing emails ever.</span>
            </div>

            <div class="form-group">
              <label for="authRegisterPassword">Password</label>
              <input type="password" id="authRegisterPassword" placeholder="Choose a password" aria-label="Password"
                autocomplete="new-password" />
              <span class="form-hint">At least 8 characters.</span>
              <div class="password-strength" id="passwordStrength" aria-live="polite">
                <div class="password-strength-bar" role="presentation">
                  <div class="password-strength-fill" id="passwordStrengthFill"></div>
                </div>
                <span class="password-strength-label" id="passwordStrengthLabel">Start typing to check strength</span>
              </div>
            </div>

            <div class="form-group">
              <label for="authRegisterConfirm">Confirm Password</label>
              <input type="password" id="authRegisterConfirm" placeholder="Re-enter your password"
                aria-label="Confirm password" autocomplete="new-password" />
            </div>

            <div class="form-group">
              <label for="authRegisterDisplayName">Display Name</label>
              <input type="text" id="authRegisterDisplayName" placeholder="Pick a display name"
                aria-label="Display name" maxlength="50" />
              <span class="form-hint">Shown in chat, voice, and presence lists.</span>
            </div>
          </section>

          <section id="authProfileSection" class="auth-section hidden flex flex-col gap-5 mb-6">
            <div class="form-group">
              <label for="authProfileAccountEmail">Account Email</label>
              <input type="email" id="authProfileAccountEmail" aria-label="Account email" readonly disabled />
              <span class="form-hint">Contact support to change your login email.</span>
            </div>

            <div class="form-group">
              <label for="authProfileDisplayName">Display Name</label>
              <input type="text" id="authProfileDisplayName" placeholder="Display name" aria-label="Display name"
                maxlength="50" />
            </div>

            <div class="form-group">
              <label for="authProfileContactEmail">Backup Email (optional)</label>
              <input type="email" id="authProfileContactEmail" placeholder="name@example.com" aria-label="Backup email"
                maxlength="254" autocomplete="email" />
            </div>

            <div class="form-group">
              <label for="authProfileBio">Bio</label>
              <textarea id="authProfileBio" placeholder="Tell others about yourself" aria-label="User bio"
                maxlength="500"></textarea>
            </div>

            <p class="mt-6 mb-3 text-[0.7rem] font-semibold tracking-[0.12em] uppercase text-text-muted">Change Password
            </p>

            <div class="form-group">
              <label for="authProfileCurrentPassword">Current Password</label>
              <input type="password" id="authProfileCurrentPassword" placeholder="Enter current password"
                aria-label="Current password" autocomplete="current-password" />
              <span class="form-hint">Required to set a new password.</span>
            </div>

            <div class="form-group">
              <label for="authProfileNewPassword">New Password</label>
              <input type="password" id="authProfileNewPassword" placeholder="Choose a new password"
                aria-label="New password" autocomplete="new-password" />
            </div>

            <div class="form-group">
              <label for="authProfileNewPasswordConfirm">Confirm New Password</label>
              <input type="password" id="authProfileNewPasswordConfirm" placeholder="Confirm new password"
                aria-label="Confirm new password" autocomplete="new-password" />
            </div>
          </section>

          <div id="regError" class="form-error" aria-live="polite"></div>
        </div>
        <div class="modal-footer">
          <button id="logoutBtn" class="button-secondary hidden" type="button">Log Out</button>
          <button id="registerBtn" class="button-primary" type="button">Create Account</button>
        </div>
      </div>
    </div>

    <!-- Audio Settings Modal -->
    <div id="audioSettingsModal" class="modal hidden" role="dialog" aria-modal="true"
      aria-labelledby="audio-settings-title">
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="audio-settings-title">‚öôÔ∏è Audio & Voice Settings</h3>
          <button id="audioSettingsCancel" aria-label="Close audio settings">‚úï</button>
        </div>
        <div class="modal-body modal-body-scrollable">
          <!-- Device Selection -->
          <div class="settings-section">
            <h4 class="settings-section-title">üé§ Devices</h4>

            <div class="form-group">
              <label for="micSelect">Microphone</label>
              <select id="micSelect" aria-label="Select microphone">
                <option>Loading devices...</option>
              </select>
            </div>

            <div class="form-group">
              <label for="spkSelect">Speakers/Output</label>
              <select id="spkSelect" aria-label="Select speakers">
                <option>Loading devices...</option>
              </select>
            </div>

            <div class="form-group">
              <label>Microphone Level</label>
              <div class="level-meter">
                <div id="micLevel" class="level-bar"></div>
              </div>
              <button id="testMicBtn" class="button-secondary" style="margin-top: 8px;" data-testing="false">Test
                Microphone</button>
            </div>
          </div>

          <!-- Voice Processing -->
          <div class="settings-section">
            <h4 class="settings-section-title">üîä Voice Processing</h4>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="echoCancel" checked />
                <span>Echo Cancellation</span>
              </label>
              <span class="form-hint">Removes echo and feedback</span>
            </div>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="noiseSuppression" checked />
                <span>Noise Suppression</span>
              </label>
              <span class="form-hint">Reduces background noise</span>
            </div>

            <div class="form-group">
              <label for="noiseReducerLevel">Background Filter: <span id="noiseReducerVal">Balanced</span></label>
              <input type="range" id="noiseReducerLevel" min="0" max="1" step="0.05" value="0.35" />
              <span class="form-hint">Higher values clamp more ambient noise but may trim very quiet speech.</span>
            </div>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="autoGain" checked />
                <span>Auto Gain Control</span>
              </label>
              <span class="form-hint">Automatically adjusts volume</span>
            </div>

            <div class="form-group">
              <label for="voiceQuality">Voice Quality</label>
              <select id="voiceQuality" class="form-input">
                <option value="32000">Low (32kbps) - Mobile</option>
                <option value="64000">Standard (64kbps)</option>
                <option value="96000">High (96kbps)</option>
                <option value="128000" selected>Studio (128kbps)</option>
              </select>
              <span class="form-hint">Higher quality uses more bandwidth</span>
            </div>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="dtx" checked />
                <span>Discontinuous Transmission (DTX)</span>
              </label>
              <span class="form-hint">Saves bandwidth when silent</span>
            </div>

            <div class="form-group">
              <label for="latencyHint">Audio Latency</label>
              <select id="latencyHint" class="form-input">
                <option value="interactive" selected>Interactive (Lowest)</option>
                <option value="balanced">Balanced</option>
                <option value="playback">Playback (Highest Quality)</option>
              </select>
              <span class="form-hint">Lower latency for real-time chat</span>
            </div>

            <div class="form-group">
              <label for="vadThreshold">Voice Activation Sensitivity: <span id="vadThresholdVal">Medium</span></label>
              <input type="range" id="vadThreshold" min="0.01" max="0.20" step="0.01" value="0.07" />
              <span class="form-hint">Lower = more sensitive (picks up quieter sounds)</span>
            </div>
          </div>

          <!-- Volume Controls -->
          <div class="settings-section">
            <h4 class="settings-section-title">üéöÔ∏è Volume</h4>

            <div class="form-group">
              <label for="micGain">Microphone Gain: <span id="micGainVal">1.0x</span></label>
              <input type="range" id="micGain" min="0.5" max="2.0" step="0.1" value="1.0" />
            </div>

            <div class="form-group">
              <label for="outputVol">Output Volume: <span id="outputVolVal">100%</span></label>
              <input type="range" id="outputVol" min="0" max="1" step="0.05" value="1" />
            </div>
          </div>

          <!-- Push to Talk -->
          <div class="settings-section">
            <h4 class="settings-section-title">üéôÔ∏è Push to Talk</h4>

            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" id="pttEnable" />
                <span>Enable Push to Talk</span>
              </label>
              <span class="form-hint">Hold key to transmit</span>
            </div>

            <div class="form-group">
              <label for="pttKey">PTT Key</label>
              <div style="display: flex; gap: 8px;">
                <input type="text" id="pttKey" value="Space" readonly placeholder="Press Set Key button" />
                <button id="pttSetKey" class="button-secondary">Set Key</button>
              </div>
              <span class="form-hint">Click Set Key and press the key you want to use</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="audioSettingsSave" class="button-primary">Save Settings</button>
        </div>
      </div>
    </div>
    <!-- Mobile Navigation Toolbar -->
    <nav id="mobile-toolbar" class="mobile-toolbar" aria-label="Mobile navigation">
      <button id="mobile-open-channels" class="mobile-toolbar-btn" type="button" aria-label="Open channels">
        <span class="icon" aria-hidden="true">‚ò∞</span>
        <span class="label">Channels</span>
      </button>
      <button id="mobile-open-settings" class="mobile-toolbar-btn" type="button" aria-label="Open settings">
        <span class="icon" aria-hidden="true">‚öôÔ∏è</span>
        <span class="label">Settings</span>
      </button>
      <button id="mobile-open-profile" class="mobile-toolbar-btn" type="button" aria-label="Open profile settings">
        <span class="icon" aria-hidden="true">üë§</span>
        <span class="label">Profile</span>
      </button>
    </nav>
  </div>
  <!-- Superuser Control Modal -->
  <div id="superuserModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="superuser-modal-title">
    <div class="modal-card modal-large superuser-modal-card">
      <div class="modal-header">
        <h3 id="superuser-modal-title">Superuser Control Center</h3>
        <button id="superuserModalClose" aria-label="Close superuser controls">‚úï</button>
      </div>
      <div class="modal-body modal-body-scrollable">
        <div class="modal-tabs" role="tablist" aria-label="Superuser sections">
          <button id="superuserTabUsers" class="modal-tab" role="tab" aria-selected="true">Users</button>
          <button id="superuserTabChannels" class="modal-tab" role="tab" aria-selected="false">Channels</button>
        </div>
        <div class="superuser-panels">
          <section id="superuserUsersPanel" class="superuser-panel active" data-panel="users" role="tabpanel"
            aria-labelledby="superuserTabUsers">
            <div class="superuser-panel-header">
              <p>Review accounts, disable access, or re-enable users.</p>
            </div>
            <div id="superuserUsersList" class="superuser-list" role="table"></div>
          </section>
          <section id="superuserChannelsPanel" class="superuser-panel" data-panel="channels" role="tabpanel"
            aria-labelledby="superuserTabChannels" hidden>
            <div class="superuser-panel-header">
              <p>Manage channels, review usage, and remove unused rooms.</p>
            </div>
            <div id="superuserChannelsList" class="superuser-list" role="table"></div>
          </section>
        </div>
      </div>
    </div>
  </div>


  <script type="module" src="/src/main.ts"></script>
</body>

</html>